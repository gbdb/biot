{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}Importer des semences | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:species_seedcollection_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {% trans 'Importer CSV/JSON' %}
</div>
{% endblock %}

{% block content %}
<h1>Importer des semences (catalogues fournisseurs)</h1>

<p>
    Importez des collections de semences depuis un fichier CSV ou JSON.
    Le mapping des colonnes est flexible : noms latins, variétés, lots, fournisseurs, etc.
</p>

{% if form.errors %}
    <div class="errornote">
        <p>Veuillez corriger les erreurs ci-dessous.</p>
        <ul>
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    <li>{{ field }}: {{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}

    <fieldset class="module aligned">
        <h2>Fichier à importer</h2>

        <div class="form-row">
            <div>
                <label for="{{ form.file.id_for_label }}">{{ form.file.label }}:</label>
                {{ form.file }}
                {% if form.file.help_text %}
                    <p class="help">{{ form.file.help_text }}</p>
                {% endif %}
                {% if form.file.errors %}
                    <ul class="errorlist">
                        {% for error in form.file.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </fieldset>

    <fieldset class="module aligned">
        <h2>Options d'import</h2>

        <div class="form-row">
            <div>
                <label for="{{ form.supplier.id_for_label }}">{{ form.supplier.label }}:</label>
                {{ form.supplier }}
                {% if form.supplier.help_text %}
                    <p class="help">{{ form.supplier.help_text }}</p>
                {% endif %}
            </div>
        </div>

        <div class="form-row">
            <div>
                <label for="{{ form.limit.id_for_label }}">{{ form.limit.label }}:</label>
                {{ form.limit }}
                {% if form.limit.help_text %}
                    <p class="help">{{ form.limit.help_text }}</p>
                {% endif %}
            </div>
        </div>

        <div class="form-row">
            <div>
                {{ form.update_existing }}
                <label for="{{ form.update_existing.id_for_label }}">{{ form.update_existing.label }}</label>
                {% if form.update_existing.help_text %}
                    <p class="help">{{ form.update_existing.help_text }}</p>
                {% endif %}
            </div>
        </div>
    </fieldset>

    <div class="submit-row">
        <input type="submit" value="Importer" class="default" />
        <a href="{% url 'admin:species_seedcollection_changelist' %}" class="button">Annuler</a>
    </div>
</form>

<div class="module">
    <h2>Colonnes reconnues</h2>
    <p>Le mapping accepte plusieurs noms de colonnes par champ. Exemples :</p>
    <ul>
        <li><strong>Organisme :</strong> latin_name, nom_latin, species, scientific_name ; common_name, nom_commun</li>
        <li><strong>Variété :</strong> variete, variety, cultivar</li>
        <li><strong>Lot :</strong> lot_reference, lot_number, batch</li>
        <li><strong>Quantité :</strong> quantite, quantity, count</li>
        <li><strong>Stratification :</strong> stratification_requise, stratification_days, cold_stratification</li>
    </ul>
    <p>Voir <code>species/seed_mapping.py</code> pour la liste complète des alias.</p>
</div>
{% endblock %}
