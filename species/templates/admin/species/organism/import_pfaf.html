{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}Importer PFAF | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:app_list' app_label=opts.app_label %}">{{ opts.app_config.verbose_name }}</a>
&rsaquo; <a href="{% url 'admin:species_organism_changelist' %}">{{ opts.verbose_name_plural|capfirst }}</a>
&rsaquo; {% trans 'Importer PFAF' %}
</div>
{% endblock %}

{% block content %}
<h1>Importer des données PFAF</h1>

<p>
    Importez des plantes depuis un fichier PFAF (Plants For A Future).
    Formats supportés: JSON, CSV, SQLite (.sqlite, .db).
</p>

{% if form.errors %}
    <div class="errornote">
        <p>Veuillez corriger les erreurs ci-dessous.</p>
        <ul>
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    <li>{{ field }}: {{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
{% endif %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    <fieldset class="module aligned">
        <h2>Fichier à importer</h2>
        
        <div class="form-row">
            <div>
                <label for="{{ form.file.id_for_label }}">{{ form.file.label }}:</label>
                {{ form.file }}
                {% if form.file.help_text %}
                    <p class="help">{{ form.file.help_text }}</p>
                {% endif %}
                {% if form.file.errors %}
                    <ul class="errorlist">
                        {% for error in form.file.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </fieldset>

    <fieldset class="module aligned">
        <h2>Options d'import</h2>
        
        <div class="form-row">
            <div>
                <label for="{{ form.limit.id_for_label }}">{{ form.limit.label }}:</label>
                {{ form.limit }}
                {% if form.limit.help_text %}
                    <p class="help">{{ form.limit.help_text }}</p>
                {% endif %}
                {% if form.limit.errors %}
                    <ul class="errorlist">
                        {% for error in form.limit.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>

        <div class="form-row">
            <div>
                <label for="{{ form.merge_mode.id_for_label }}">{{ form.merge_mode.label }}:</label>
                {{ form.merge_mode }}
                {% if form.merge_mode.help_text %}
                    <p class="help">{{ form.merge_mode.help_text }}</p>
                {% endif %}
                {% if form.merge_mode.errors %}
                    <ul class="errorlist">
                        {% for error in form.merge_mode.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>

        <div class="form-row">
            <div>
                <label for="{{ form.table.id_for_label }}">{{ form.table.label }}:</label>
                {{ form.table }}
                {% if form.table.help_text %}
                    <p class="help">{{ form.table.help_text }}</p>
                {% endif %}
                {% if form.table.errors %}
                    <ul class="errorlist">
                        {% for error in form.table.errors %}
                            <li>{{ error }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
            </div>
        </div>
    </fieldset>

    <div class="submit-row">
        <input type="submit" value="Importer" class="default" />
        <a href="{% url 'admin:species_organism_changelist' %}" class="button">Annuler</a>
    </div>
</form>

<div class="module">
    <h2>Informations</h2>
    <ul>
        <li><strong>Mode fill_gaps (défaut):</strong> Ne remplit que les champs vides. Préserve les données Hydro-Québec existantes.</li>
        <li><strong>Mode overwrite:</strong> Remplace tous les champs, même s'ils sont déjà remplis.</li>
        <li>Les données brutes PFAF sont stockées dans <code>data_sources['pfaf']</code> pour chaque organisme.</li>
        <li>Pour les fichiers SQLite, le nom de la table par défaut est <code>plant_data</code> (base pfaf-data GitHub).</li>
    </ul>
</div>
{% endblock %}
